<?php 
if (defined('RUNNING_FROM_ROOT')) {
  $this->plugin('basePath')->setBasePath($this->basePath().'/public');
} 
  echo $this->headLink()
     ->appendStylesheet($this->basePath() . '/js/downloads/css/dropzone.css')
     ->appendStylesheet($this->basePath() . '/js/fotorama/fotorama.css')
     ->appendStylesheet($this->basePath() . '/css/blueimp/blueimp-gallery.min.css');
  echo $this->headScript()
         ->appendFile($this->basePath() . '/js/downloads/dropzone.js')
<<<<<<< HEAD
         ->appendFile($this->basePath() . '/js/fotorama/fotorama.js')
         ->appendFile($this->basePath() . '/js/bootstrap-contextmenu.js')
         ->appendFile($this->basePath() . '/js/jquery-ui/jquery-ui.min.js')
         ->appendFile($this->basePath() . '/js/blueimp/blueimp-gallery.min.js');
=======
         ->appendFile($this->basePath() . '/js/fotorama/fotorama.js');
>>>>>>> 66cfea633e0b110b65b24c5499444913323db719
   $rolusuario = $this->identity()->getRole()->getId();
 ?>
<style type="text/css">
  #contextMenu {
  position: absolute;
}
</style>
<?php if(($estado[0]['ESTADO'] == 4 || $estado[0]['ESTADO'] == 3) && $estado[0]['REVISION'] == true) { ?>
    <a href="<?php echo $this->basePath().'/estudios/interpretacionpdf/'.$idEstudio ?>"><button type="button" style="margin-top:20px;margin-bottom:20px" class="btn btn-warning">Imprimir interpretaci칩n.</button></a>
<?php } ?>
<h4>Interpretaci칩n del estudio.</h4> 
<textarea class="form-control" rows="25" style="margin-bottom:20px" id="interpretacion" <?php if($estado[0]['ESTADO'] == 3 || ($estado[0]['ESTADO'] == 2 && $estado[0]['REVISION'] == false) || ($rolusuario != 4 && $rolusuario != 5 && $rolusuario != 7)) { echo "disabled";} ?>><?php echo $estado[0]['INTERPRETACION'] ?></textarea>
<<<<<<< HEAD
<div id="links">
  <?php if($imagenes) {
          foreach($imagenes as $i) { $foto = explode('.',$i['IMAGEN']);?>            
              <a href="<?php echo $this->basePath().'/imagenes/Estudios/'.$idEstudio.'/'.$i['IMAGEN']?>"> 
                <img class="imagenesx" id="<?php echo $foto[0]; ?>" ext="<?php echo $foto[1]; ?>" src="<?php echo $this->basePath().'/imagenes/Estudios/'.$idEstudio.'/'.$foto[0].'_th.'.$foto[1]?>">
              </a>
  <?php } ?>
 <?php } ?>
</div>
<?php if(($estado[0]['ESTADO'] == 2 || $estado[0]['ESTADO'] == 9) && ($rolusuario == 4 || $rolusuario == 7 || $rolusuario == 5) && $estado[0]['REVISION'] == true) { ?>
=======
<div class="fotorama" data-nav="thumbs" data-width="100%" data-ratio="800/600">
	<?php if($imagenes) {
          foreach($imagenes as $i) { $foto = explode('.',$i['IMAGEN']);?>
		        <a href="<?php echo $this->basePath().'/imagenes/Estudios/'.$idEstudio.'/'.$i['IMAGEN']?>"> 
              <img src="<?php echo $this->basePath().'/imagenes/Estudios/'.$idEstudio.'/'.$foto[0].'_th.'.$foto[1]?>">
            </a>
	<?php } ?>
 <?php } ?>
</div>
<?php if($estado[0]['ESTADO'] == 2 || $estado[0]['ESTADO'] == 9 && ($rolusuario == 4 || $rolusuario == 7 || $rolusuario == 5)) { ?>
>>>>>>> 66cfea633e0b110b65b24c5499444913323db719
<div class="panel-heading">
      <?php if($rolusuario == 5) { ?>
      <h4 class="panel-title">
        <a data-toggle="collapse" data-parent="#accordion" href="#collapseOne" style="color:dodgerblue">
          A침adir im치genes
        </a>
      </h4>
    </div>
    <div id="collapseOne" class="panel-collapse collapse">
      <div class="panel-body">
          <form action="<?php echo $this->basePath() ?>/estudios/recibir" class="dropzone" id="zona-drop">
            <input type="hidden" name="PACIENTE" value="<?php echo $idPaciente ?>" />
            <input type="hidden" name="ESTUDIO" value="<?php echo $idEstudio ?>" />
          </form>

      </div>
    </div>
    <?php } ?>
<div class="col-sm-12">
  <button type="button" class="btn btn-primary" style="float:right" onclick="interpretacion()">
    Guardar estudio
  </button>
</div>
<?php } ?>
<<<<<<< HEAD
<?php if(($estado[0]['ESTADO'] == 3 && $estado[0]['REVISION'] == false) && ($rolusuario == 4 || $rolusuario == 5 || $rolusuario == 7)) { ?>
=======
<?php if($estado[0]['ESTADO'] == 3 && $estado[0]['REVISION'] == false && ($rolusuario == 4 || $rolusuario == 5 || $rolusuario == 7)) { ?>
>>>>>>> 66cfea633e0b110b65b24c5499444913323db719
    <button type="button" class="btn btn-warning" onclick="abrirestudio()">Abrir estudio para int.</button>
<?php } ?>
<script>
<<<<<<< HEAD
$(document).ready(function(){
  document.getElementById('links').onclick = function (event) {
      event = event || window.event;
      var target = event.target || event.srcElement,
          link = target.src ? target.parentNode : target,
          options = {index: link, event: event,slideshowInterval: 1},
          links = this.getElementsByTagName('a');
      blueimp.Gallery(links, options);
  };
});
<?php if(($estado[0]['ESTADO'] == 2 || $estado[0]['ESTADO'] == 9) && ($rolusuario == 4 || $rolusuario == 7 || $rolusuario == 5)) { ?>
$('.imagenesx').contextmenu({
    target:'#context-menu',
    onItem: function(context) {
      borrarImagen(context[0].id,context[0].attributes.ext.value);
    }
  });
=======
<?php if($estado[0]['ESTADO'] == 2 || $estado[0]['ESTADO'] == 9 && ($rolusuario == 4 || $rolusuario == 7 || $rolusuario == 5)) { ?>
>>>>>>> 66cfea633e0b110b65b24c5499444913323db719
var myDropzone = new Dropzone("#zona-drop", {
  paramName: "file", // The name that will be used to transfer the file
    maxFilesize: 2, // MB
    accept: function(file, done) {
      done();
    },
    addRemoveLinks: true,
    removedfile: function(file){
      var datos = {archivo:file.name,estudio:<?php echo $idEstudio; ?>};
      $.ajax({
            type: "POST",
            url: "<?php echo $this->basePath() ?>/estudios/remover",
            data: datos,
            dataType: "json",
            success: function(data) {
                    var _ref;
                       if (file.previewElement) {
                         if ((_ref = file.previewElement) != null) {
                           _ref.parentNode.removeChild(file.previewElement);
                         }
                       }
                       return this._updateMaxFilesReachedClass();
                  },
            error: function(data){
                        var _ref;
                          if (file.previewElement) {
                            if ((_ref = file.previewElement) != null) {
                              _ref.parentNode.removeChild(file.previewElement);
                            }
                          }
                          return this._updateMaxFilesReachedClass();
 
            }
        });
      }
});
function interpretacion() {
     var interpretacion = document.getElementById('interpretacion').value;
     $.ajax({
              type: "POST",
              url: "<?php echo $this->basePath() ?>/estudios/interpretacion",
              dataType: "json",
              data: {inter:interpretacion,estudio:<?php echo $idEstudio ?>},
              success: function(data) {
                location.reload(true);
              },
              error: function(){
                
              }
        });
}
function borrarImagen(id,extension) {
  var aceptar = confirm("Esta seguro que desea eliminar la imagen '"+id+"' ?");
  if(aceptar === true) {
    $.ajax({
             type: "POST",
             url: "<?php echo $this->basePath() ?>/estudios/remover",
             dataType: "json",
             data: {imagen:id,ext:extension,estudio:<?php echo $idEstudio ?>},
             success: function(data) {
               location.reload(true);
             },
             error: function(){
               
             }
       });
  }
}
<?php } ?>

<<<<<<< HEAD
<?php if(($estado[0]['ESTADO'] == 3 && $estado[0]['REVISION'] == false) && ($rolusuario == 4 || $rolusuario == 5 || $rolusuario == 7)) { ?>
=======
<?php if($estado[0]['ESTADO'] == 3 && $estado[0]['REVISION'] == false && ($rolusuario == 4 || $rolusuario == 5 || $rolusuario == 7)) { ?>
>>>>>>> 66cfea633e0b110b65b24c5499444913323db719
function abrirestudio() {
  $.ajax({
           type: "POST",
           url: "<?php echo $this->basePath() ?>/estudios/abrirestudio",
           dataType: "json",
           data: {estudio:<?php echo $idEstudio ?>},
           success: function(data) {
             location.reload(true);
           },
           error: function(){
             
           }
     });
}
<?php } ?>
</script>